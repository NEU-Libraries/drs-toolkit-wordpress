(()=>{"use strict";const t=Backbone.Model.extend({defaults:{title:"",pid:"",thumbnail:"",repo:"",color:"",key_date:"",coords:""}}),a=Backbone.Model.extend({defaults:{name:"",value:[],choices:{},label:"",helper:"",tag:"",selectedId:"",colorHex:"",colorId:""}}),s=Backbone.Model.extend({defaults:{name:"",value:[],label:"",tag:"",colorname:"",colorHex:""}}),r=Backbone.Collection.extend({model:t}),i=Backbone.Collection.extend({model:a}),n=Backbone.Collection.extend({model:s});function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var a=0,s=new Array(t);a<t;a++)s[a]=e[a];return s}const l=Backbone.Model.extend({defaults:{type:"",items:new r,settings:new i,colorsettings:new n},initialize:function(){this.set("items",new r),this.set("settings",new i),this.set("colorsettings",new n)},parse:function(e){return e.items=new r(e.items),e.settings=new i(e.settings),e.colorsettings=new n(e.colorsettings),e},set:function(e,t){var a={items:r,settings:i,colorsettings:n};return Object.entries(a).forEach((function(t){var a,s,r=(s=2,function(e){if(Array.isArray(e))return e}(a=t)||function(e,t){var a=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=a){var s,r,i,n,o=[],l=!0,c=!1;try{if(i=(a=a.call(e)).next,0===t){if(Object(a)!==a)return;l=!1}else for(;!(l=(s=i.call(a)).done)&&(o.push(s.value),o.length!==t);l=!0);}catch(e){c=!0,r=e}finally{try{if(!l&&null!=a.return&&(n=a.return(),Object(n)!==n))return}finally{if(c)throw r}}return o}}(a,s)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var a=Object.prototype.toString.call(e).slice(8,-1);return"Object"===a&&e.constructor&&(a=e.constructor.name),"Map"===a||"Set"===a?Array.from(e):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?o(e,t):void 0}}(a,s)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=r[0],n=r[1];!e[i]||e[i]instanceof n||(e[i]=new n(e[i]))})),Backbone.Model.prototype.set.call(this,e,t)}}),c=Backbone.View.extend({color_row_template:wp.template("drstk-setting-colorinput"),tagName:"tr",initialize:function(){this.render()},render:function(){"inputcolor"==this.model.attributes.tag&&this.$el.html(this.color_row_template(this.model.toJSON()))},remove:function(){this.collection.remove(this.model)}}),d=Backbone.View.extend({templates:{checkbox:wp.template("drstk-setting-checkbox"),select:wp.template("drstk-setting-select"),text:wp.template("drstk-setting-text"),number:wp.template("drstk-setting-number")},tagName:"tr",initialize:function(){this.render()},render:function(){var e=this.templates[this.model.attributes.tag];e&&this.$el.html(e(this.model.toJSON()))}}),h=Backbone.View.extend({tagName:"li",itemTemplate:_.template("<label for='tile-<%=pid%>'><img src='<%=thumbnail%>' /><br/><input id='tile-<%=pid%>' type='checkbox' class='tile <%=repo%>' value='<%=pid%>'/><span class='title'><%=title%></span></label>"),itemNoImgTemplate:_.template("<label for='tile-<%=pid%>'><span class='dashicons dashicons-format-image'></span><br/><input id='tile-<%=pid%>' type='checkbox' class='tile <%=repo%>' value='<%=pid%>'/><span class='title'><%=title%></span></label>"),initialize:function(){this.render()},render:function(){void 0===this.model.attributes.thumbnail?this.$el.html(this.itemNoImgTemplate(this.model.toJSON())):this.$el.html(this.itemTemplate(this.model.toJSON()))}});function u(e){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},u(e)}console.log("admin test"),$=jQuery,console.log($.fn.sortable);var p={backbone_modal:{__instance:void 0},Item:t,Setting:a,ColorSetting:s,Items:r,Settings:i,ColorSettings:n,Shortcode:l,ColorSettingView:c,SettingView:d,ItemView:h},m=1;p.backbone_modal.Application=Backbone.View.extend({id:"backbone_modal_dialog",events:{"change #drs-select-all-item":"selectAllItem","click .backbone_modal-close":"closeModal","click #btn-cancel":"closeModal","click #btn-ok":"insertShortcode","click .navigation-bar a":"navigate","click .backbone_modal-main article table .button":"navigate","change .tile":"selectItem","click .tablenav-pages a":"paginate","click .nav-tab":"navigateShortcode","click .search-button":"search","change #settings input":"settingsChange","change #settings select":"settingsChange","change #selected select[name='color']":"changeColor","click #local #wp_media":"addMediaItems","change select[name='dpla-sort']":"dplaSort","change select[name='drs-sort']":"drsSort","click .dpla-facets-button":"dplaFacetToggle","click .drs-facets-button":"drsFacetToggle","click .dpla-close-facets":"dplaFacetToggle","click .drs-close-facets":"drsFacetToggle","click .dpla-facet-add":"dplaFacet","click .drs-facet-add":"drsFacet","click .dpla-update-date":"dplaUpdateDate","click .dpla-facet-remove":"dplaFacetRemove","click .drs-facet-remove":"drsFacetRemove","click .dpla-expand-facet":"dplaFacetExpand","click .drs-expand-facet":"drsFacetExpand","click #addcolorbutton":"settingsAddColor","click .delete-color-row":"deleteColorRow"},ui:{nav:void 0,content:void 0},templates:{},shortcode:null,geoCount:0,timeCount:0,selectAll:!1,oldShortcode:null,collectionId:drstk_backbone_modal_l10n.collection_id,options:{},resultCount:0,searchParams:{q:"",page:1,facets:{},sort:""},currentTab:0,tabs:{1:"single",2:"tile",3:"slider",4:"media",5:"map",6:"timeline"},initialize:function(t){if(this.options=t,_.bindAll(this,"render","preserveFocus","closeModal","insertShortcode","navigate","showTab","getDRSitems","selectItem","paginate","navigateShortcode","search","setDefaultSettings","selectAllItem","settingsAddColor","deleteColorRow"),this.initializeTemplates(),this.render(),this.shortcode=new p.Shortcode({}),this.options&&""!=this.options.currentTab){var a={currentTarget:""},s=_.invert(this.tabs)[this.options.currentTab],r={1:"one",2:"two",3:"three",4:"four",5:"five",6:"six"}[s];a.currentTarget="<a href='#"+r+"'></a>",this.searchParams.q="",this.searchParams.page=1,this.navigate(a),this.currentTab=s,this.shortcode.type=this.tabs[this.currentTab]}else this.currentTab=1;var i=this,n=1;if(this.options&&this.options.items&&this.options.items.length>0?_.each(this.options.items,(function(e,t){0==t?i.shortcode.items=new p.Items(e):i.shortcode.items.add(e)})):this.options&&(i.selectAll=!0,jQuery(".backbone_modal-main #drs-select-all-item").prop("checked",!0)),this.options&&(this.options.items&&this.options.items.length>0||this.options.collectionId&&this.options.collectionId.length>0)){var o=this.options.settings;_.each(this.options.settings,(function(e,t){if(t.match(/([a-zA-Z_0-9-]*)_color_desc_id/)){var a=t.match(/([a-zA-Z_0-9-]*)_color_desc_id/)[1],s="#"+o[a+"_color_hex"];if(a&&s){var r=i.shortcode.get("colorsettings"),l="label-text-"+n+"_desc",c="label-"+n,d="label-"+n;a=a.replace("_"," "),r.add({name:l,value:c,label:d,tag:"inputcolor",colorname:a,colorHex:s}),i.shortcode.set("colorsettings",r);for(var h=e.split(","),u=0;u<h.length;u++)h[u]=h[u].trim();_.each(h,(function(e){repo=e.split(":")[0],"neu"!=repo&&(e=e.split(":")[1]),i.shortcode.items.where({pid:e})[0].attributes.color=a})),n++}}})),e.currentTarget=jQuery(".nav-tab[href='#selected']"),this.navigateShortcode(e)}this.options&&this.options.oldShortcode&&(this.oldShortcode=this.options.oldShortcode)},initializeTemplates:function(){this.templates.window=wp.template("drstk-modal-window"),this.templates.backdrop=wp.template("drstk-modal-backdrop"),this.templates.menuItem=wp.template("drstk-modal-menu-item"),this.templates.menuItemSeperator=wp.template("drstk-modal-menu-item-separator"),this.templates.tabMenu=wp.template("drstk-modal-tab-menu"),this.templates.tabItem=wp.template("drstk-modal-tab-item"),this.templates.tabContent=wp.template("drstk-modal-tab-content")},render:function(){this.$el.attr("tabindex","0").append(this.templates.window()).append(this.templates.backdrop()),this.ui.nav=this.$(".navigation-bar nav ul").append(this.templates.menuItem({url:"#one",name:"Single Item"})).append(this.templates.menuItem({url:"#two",name:"Tile Gallery"})).append(this.templates.menuItem({url:"#three",name:"Gallery Slider"})).append(this.templates.menuItemSeperator()).append(this.templates.menuItem({url:"#four",name:"Media Playlist"})).append(this.templates.menuItem({url:"#five",name:"Map"})).append(this.templates.menuItem({url:"#six",name:"Timeline"})),"object"===("undefined"==typeof drstk_backbone_modal_l10n?"undefined":u(drstk_backbone_modal_l10n))&&(this.ui.content=this.$(".backbone_modal-main article").append("<p>"+drstk_backbone_modal_l10n.replace_message+"</p>")),jQuery(document).on("focusin",this.preserveFocus),jQuery("body").css({overflow:"hidden"}).append(this.$el),this.$el.focus()},preserveFocus:function(e){this.$el[0]===e.target||this.$el.has(e.target).length||this.$el.focus()},closeModal:function(e){m=1,e.preventDefault,this.undelegateEvents(),jQuery(document).off("focusin"),jQuery("body").css({overflow:"auto"}),this.remove(),this.oldShortcode&&"btn-ok"!=jQuery(e.currentTarget).attr("id")&&window.wp.media.editor.insert(this.oldShortcode),p.backbone_modal.__instance=void 0},selectAllItem:function(e){if(e.preventDefault,jQuery("#drs-select-all-item").prop("checked"))return jQuery("#sortable-"+this.tabs[this.currentTab]+"-list").find("li input").prop("checked",!0),jQuery("#sortable-"+this.tabs[this.currentTab]+"-list").find("li input").prop("disabled",!0),jQuery(".tile").trigger("change"),jQuery(".drs-pagination .tablenav-pages").children().length>1&&this.loopThroughPages(),void(this.selectAll=!0);jQuery("#sortable-"+this.tabs[this.currentTab]+"-list").find("li input").prop("checked",!1),jQuery("#sortable-"+this.tabs[this.currentTab]+"-list").find("li input").prop("disabled",!1),this.shortcode.items.models.length=0},loopThroughPages:function(){var e=parseInt(jQuery(".drs-pagination .tablenav-pages .current-page").text()),t=jQuery(".drs-pagination .tablenav-pages .current-page").next("a");parseInt(t.text())==e+1?(jQuery(t.trigger("click")),jQuery(".drs-pagination .tablenav-pages .current-page").removeClass("current-page"),t.addClass("current-page"),this.loopThroughPages()):jQuery(".drs-pagination .tablenav-pages .prev-page").next("a").trigger("click")},insertShortcode:function(e){insertShortcodeController(e,{shortcode:this.shortcode,closeModal:this.closeModal,currentTab:this.currentTab,tabs:this.tabs,collectionId:this.collectionId})},setDefaultSettings:function(){this.shortcode=setDefaultSettingsController({shortcode:this.shortcode,options:this.options})},settingsAddColor:function(e){type=this.shortcode.get("type"),colorsettings=this.shortcode.get("colorsettings"),name="label-text-"+m+"_desc",value="label-"+m,label="label-"+m,colorname="label-color-"+m,colorsettings.add({name,value,label,tag:"inputcolor",colorname,colorHex:"#0080ff"}),this.shortcode.set("colorsettings",colorsettings),this.getSettings(),m+=1},deleteColorRow:function(e){e.preventDefault();var t="",a=-1;t=jQuery(e.currentTarget).attr("id"),type=this.shortcode.get("type"),class_name_original=t.substr(7,t.length),class_name="#settings > table.color-table > tbody > tr."+class_name_original,colorsettings=this.shortcode.get("colorsettings"),jQuery.each(colorsettings.models,(function(e,t){t.attributes.name.toString()==class_name_original&&(a=e)})),colorsettings.models.splice(a,1),this.shortcode.set("colorsettings",colorsettings),this.getSettings(),jQuery(class_name).remove()},navigate:function(e){this.searchParams.page=1,this.geoCount=0,this.timeCount=0,this.shortcode.set("settings",new p.Settings),this.shortcode.set("colorsettings",new p.ColorSettings),this.shortcode.items&&(this.selectAll=!1,this.shortcode.items=new p.Items),jQuery(".navigation-bar a").removeClass("active"),this.showTab(jQuery(e.currentTarget).attr("href"))},navigateShortcode:function(e){var t=jQuery(e.currentTarget).attr("href");if(jQuery(".nav-tab").removeClass("nav-tab-active"),jQuery(e.currentTarget).addClass("nav-tab-active"),this.searchParams.page=1,this.searchParams.q="",jQuery(".pane").hide(),"#drs"==t)return jQuery("#drs").show(),jQuery("#drs input[name='search']").val(this.searchParams.q),void this.getDRSitems();if("#dpla"==t){if(jQuery("#dpla input[name='search']").val(this.searchParams.q),jQuery("#dpla").show(),4==this.currentTab)return void jQuery("#dpla").html("<div class='notice notice-warning'><p>DPLA items cannot be used in embedded media. If you would like to use a media item from the DPLA, consider downloading it and upload it using the 'Local Items' tab.</p></div>");jQuery("#dpla ol").children("li").remove(),jQuery(".dpla-items").html("<div class='notice notice-info'></div>")}return"#local"==t?(jQuery("#local").show(),void this.getMediaitems()):"#selected"==t?(jQuery("#selected").show(),this.getSelecteditems(),tab_name=this.tabs[this.currentTab],jQuery("#drs-select-all-item").prop("checked")&&jQuery("#selected #sortable-"+tab_name+"-list").find("li input").prop("disabled",!0),void jQuery("#selected #sortable-"+tab_name+"-list").sortable({update:function(e,t){_.clone(shortcode.items.models).forEach((function(e){return e.destroy()})),Array.from(e.target.children).forEach((function(e){var t=jQuery(e).find("input").val(),a=jQuery(e).find(".title").text(),s=jQuery(e).find("img").attr("src"),r=jQuery(e).find("input").attr("class").split(" ")[1];0===shortcode.items.length?shortcode.items=new p.Items({title:a,pid:t,thumbnail:s,repo:r}):shortcode.items.add({title:a,pid:t,thumbnail:s,repo:r})}))}})):void("#settings"==t&&(jQuery("#settings").show(),this.getSettings()))},showTab:function(e){jQuery(".backbone_modal-main article").html("");var t="";switch(e){case"#one":this.currentTab=1,t="Single Item",null!=this.shortcode.items&&this.shortcode.items.length>1&&_.each(_.clone(this.shortcode.items.models),(function(e){e.destroy()}));break;case"#two":this.currentTab=2,t="Tile Gallery";break;case"#three":this.currentTab=3,t="Gallery Slider";break;case"#four":this.currentTab=4,t="Media Playlist";break;case"#five":this.currentTab=5,t="Map";break;case"#six":this.currentTab=6,t="Timeline"}jQuery(".backbone_modal-main article").append(this.templates.tabContent({title:t,type:this.tabs[this.currentTab]})),jQuery(".navigation-bar a[href="+e+"]").addClass("active"),jQuery("#drs").show(),this.selectAll||this.getDRSitems(),this.shortcode.set({type:this.tabs[this.currentTab]}),this.setDefaultSettings()},getDRSitems:function(){var e=getDRSItemsController({currentTab:this.currentTab,searchParams:this.searchParams,tabs:this.tabs,geoCount:this.geoCount,timeCount:this.timeCount,shortcodeItems:this.shortcode.items,selectAll:this.selectAll,drstk:p});this.geoCount=e.geoCount,this.timeCount=e.timeCount},selectItem:function(e){var t=selectItemController(e,{shortcode:this.shortcode,searchParams:this.searchParams});this.shortcode=t.shortcode,this.searchParams=t.searchParams},paginate:function(e){var t=jQuery.trim(jQuery(e.currentTarget).html()),a=jQuery(e.currentTarget).parents(".pane").attr("id"),s=jQuery("#".concat(a," .tablenav-pages .current-page")).html();"&lt;&lt;"===t&&(t=parseInt(current_page)-1),"&gt;&gt;"===t&&(t=parseInt(s)+1,"&gt;&gt;"===jQuery("#".concat(a," .tablenav-pages .current-page")).next("a").html()&&(t=0)),jQuery.isNumeric(t)&&0!=t&&(this.searchParams.page=t,"drs"==a?this.getDRSitems():"dpla"==a&&this.getDPLAitems())},getDPLAitems:function(){4==this.currentTab?this.searchParams.avfilter=!0:delete this.searchParams.avfilter,5==this.currentTab?this.searchParams.spatialfilter=!0:delete this.searchParams.spatialfilter,6==this.currentTab?this.searchParams.timefilter=!0:delete this.searchParams.timefilter;var e=this;tab_name=this.tabs[this.currentTab],jQuery.post(dpla_ajax_obj.ajax_url,{_ajax_nonce:dpla_ajax_obj.dpla_ajax_nonce,action:"get_dpla_code",params:this.searchParams},(function(t){if(t=jQuery.parseJSON(t),jQuery("#dpla #sortable-"+tab_name+"-list").children("li").remove(),t.count>0){if(jQuery(".dpla-items").html(""),jQuery.each(t.docs,(function(t,a){if(6==e.currentTab?date=getDateFromSourceResource(a.sourceResource):date="",5==e.currentTab?(coords=a.sourceResource.spatial[0].name,""!=a.sourceResource.spatial[0].coordinates&&null!=a.sourceResource.spatial[0].coordinates&&(coords=a.sourceResource.spatial[0].coordinates)):coords="",6==e.currentTab&&""!=date||5==e.currentTab&&""!=coords||5!=e.currentTab&&6!=e.currentTab){this_item=new p.Item;var s=a.sourceResource.title;Array.isArray(s)&&(s=s[0]),this_item.set("pid",a.id).set("thumbnail",a.object).set("repo","dpla").set("title",s),6==e.currentTab&&this_item.set("key_date",date),5==e.currentTab&&this_item.set("coords",coords),view=new p.ItemView({model:this_item}),jQuery("#dpla #sortable-"+tab_name+"-list").append(view.el),6==e.currentTab&&jQuery("#dpla #sortable-"+tab_name+"-list").find("li:last-of-type").append("<p>Date: <span class='key_date hidden'>"+date.join("-")+"</span>"+a.sourceResource.date.displayDate+"</p>"),5==e.currentTab&&jQuery("#dpla #sortable-"+tab_name+"-list").find("li:last-of-type").append("<p>Map Info: <span class='coords hidden'>"+this_item.get("coords")+"</span>"+this_item.get("coords")+"</p>"),null!=e.shortcode.items&&e.shortcode.items.where({pid:a.id}).length>0&&(jQuery("#dpla #sortable-"+tab_name+"-list").find("li:last-of-type input").prop("checked",!0),short_item=e.shortcode.items.where({pid:a.id})[0],short_item.get("title")||short_item.set("title",s),short_item.get("thumbnail")||short_item.set("thumbnail",a.object),short_item.get("key_date")&&""!=short_item.get("key_date")&&null!=short_item.get("key_date")&&short_item.get("key_date")!=[]||6!=e.currentTab||short_item.set("key_date",date),short_item.get("coords")&&""!=short_item.get("coords")&&null!=short_item.get("coords")||5!=e.currentTab||short_item.set("coords",coords))}})),""!=e.searchParams.q&&e.updateDPLAPagination(t),e.searchParams.facets!={}){jQuery(".dpla-type, .dpla-subject").html(""),_.each(t.facets,(function(e,t){if(("sourceResource.contributor"==t||"sourceResource.subject.name"==t||"sourceResource.type"==t)&&("sourceResource.contributor"==t&&(this_facet="creator"),"sourceResource.subject.name"==t&&(this_facet="subject"),"sourceResource.type"==t&&(this_facet="type"),jQuery(".dpla-"+this_facet).html("<b>"+this_facet.charAt(0).toUpperCase()+this_facet.slice(1)+"</b>"),null!=e.terms&&e.terms.length>0)){for(var a=0;a<=4;a++)null!=e.terms[a]&&(facet_val=e.terms[a].term,facet_count=e.terms[a].count,facet_html="<tr><td><a href='' data-facet-val='"+facet_val+"' data-facet-name='"+this_facet+"' class='dpla-facet-add'>"+facet_val+"</a></td><td><a href=''>"+facet_count+"</a></td></tr>",jQuery(".dpla-"+this_facet).append(facet_html));e.terms.length>5&&(facet_html="<a href='' class='dpla-expand-facet' data-facet-name='"+this_facet+"'>View More</a><div class='dpla-expanded-facet-"+this_facet+" hidden'><table>",_.each(e.terms,(function(e,t){t>4&&(facet_html+="<tr><td><a href='' data-facet-val='"+e.term+"' data-facet-name='"+this_facet+"' class='dpla-facet-add'>"+e.term+"</a></td><td><a href=''>"+e.count+"</a></td></tr>")})),facet_html+="</table></div>",jQuery(".dpla-"+this_facet).append(facet_html))}})),jQuery(".dpla-date").html("<b>Date Created</b><br/><div class='dpla-date-slider'></div><span class='start'></span> - <span class='end'> </span><a class='button dpla-update-date'>Update</a>"),dates=[1e3,(new Date).getFullYear()];var a=(new Date).getFullYear();null!=e.searchParams.facets.date&&(dates=e.searchParams.facets.date),jQuery(".dpla-date-slider").slider({range:!0,min:parseInt(1e3),max:parseInt(a),values:dates,slide:function(t,a){e.searchParams.facets.date=[a.values[0],a.values[1]],jQuery(".dpla-date .start").text(a.values[0]),jQuery(".dpla-date .end").text(a.values[1])},create:function(t){null!=e.searchParams.facets.date?(jQuery(".dpla-date .start").text(e.searchParams.facets.date[0]),jQuery(".dpla-date .end").text(e.searchParams.facets.date[1])):(jQuery(".dpla-date .start").text(parseInt(1e3)),jQuery(".dpla-date .end").text(parseInt(a)))}}),facet_buttons="",_.each(e.searchParams.facets,(function(e,t){"date"!=t&&("string"==typeof e?facet_buttons+="<a href='' data-facet-name='"+t+"' data-facet-val='"+e+"' class='button dpla-facet-remove'>"+t.charAt(0).toUpperCase()+t.slice(1)+" : "+e+" <span class='dashicons dashicons-trash'> </span></a>":_.each(e,(function(e){facet_buttons+="<a href='' data-facet-name='"+t+"' data-facet-val='"+e+"' class='button dpla-facet-remove'>"+t.charAt(0).toUpperCase()+t.slice(1)+" : "+e+" <span class='dashicons dashicons-trash'> </span></a>"})))})),jQuery(".dpla-chosen").html(facet_buttons)}}else jQuery(".dpla-items").html("<div class='notice notice-warning'><p>No results were retrieved for your query. Please try a different query.</p></div>"),jQuery("#dpla-pagination").html("")})),jQuery(".dpla-facets-button").hasClass("hidden")&&jQuery(".dpla-facets").hasClass("hidden")&&jQuery(".dpla-facets-button").removeClass("hidden")},updateDPLAPagination:function(e){if(num_pages=Math.round(e.count/e.limit),current_page=parseInt(this.searchParams.page),num_pages>1){var t="";current_page>1&&(t+="<a href='#' class='prev-page' data-val='"+parseInt(current_page-1)+"'>&lt;&lt;</a>"),current_page>=3&&(t+="<a href='#' class=''>"+parseInt(current_page-2)+"</a>"),current_page>=2&&(t+="<a href='#' class=''>"+parseInt(current_page-1)+"</a>"),t+="<a href='#' class='current-page active'>"+current_page+"</a>",current_page+1<num_pages&&(t+="<a href='#' class=''>"+parseInt(current_page+1)+"</a>"),current_page+2<num_pages&&(t+="<a href='#' class=''>"+parseInt(current_page+2)+"</a>"),current_page+1!=num_pages&&(t+="<a href='#' class='next-page' data-val='"+parseInt(current_page+1)+"'>&gt;&gt;</a>"),jQuery("#dpla-pagination").html("<span class='tablenav'><span class='tablenav-pages'>"+t+"</span></span>")}else jQuery("#dpla-pagination").html("")},search:function(e){this.searchParams.q=jQuery(e.currentTarget).siblings("input.drstk-search-input").val(),parent=jQuery(e.currentTarget).parents(".pane").attr("id"),"drs"==parent?this.getDRSitems():"dpla"==parent&&this.getDPLAitems()},getSelecteditems:function(){getSelecteditemsController({tabs:this.tabs,currentTab:this.currentTab,shortcode:this.shortcode,selectAll:this.selectAll,drstk:p,options:this.options})},getSettings:function(){jQuery("#settings").html("<table />"),_.each(this.shortcode.get("settings").models,(function(e,t){var a=new p.SettingView({model:e});jQuery("#settings table").append(a.el),jQuery("#settings table tr:last-of-type").addClass(e.get("name"))})),type=this.shortcode.get("type"),"map"!=type&&"timeline"!=type||(jQuery("#settings").append("<div class='toolkitcolors'><h4>Color Settings</h4><button type='button' id ='addcolorbutton'>Add Color</button><br/><table class ='color-table striped'><tbody><tr class='colorheader'><td><h5>Description</h5></td><td><h5>Color Value</h5></td></tr></tbody></table></div>"),_.each(this.shortcode.get("colorsettings").models,(function(e,t){var a=new p.ColorSettingView({model:e});jQuery("#settings .color-table").append(a.el),jQuery(jQuery("#settings .color-table tr:last-of-type").addClass(e.get("name")))})))},settingsChange:function(e){this.shortcode=settingsChangeController(e,{shortcode:this.shortcode})},changeColor:function(e){color=jQuery(e.currentTarget).val(),""!=color&&(pid=jQuery(e.currentTarget).siblings(".tile").val(),item=this.shortcode.items.where({pid}),item[0].set({color}))},getMediaitems:function(){if(jQuery("#local").html("<a class='button' id='wp_media'>Add or Browse Local Items</a><br/>"),null!=this.shortcode.items&&this.shortcode.items.where({repo:"local"}).length>0){var e=this;_.each(this.shortcode.items.where({repo:"local"}),(function(t){pid=t.get("pid"),thumbnail=t.get("thumbnail"),repo="local",title=t.get("title"),this_item=new p.Item,this_item.set("pid",pid).set("thumbnail",thumbnail).set("repo",repo).set("title",title).set("coords",t.get("coords")).set("key_date",t.get("key_date")),(6==e.currentTab&&null==this_item.get("key_date")||5==e.currentTab&&null==this_item.get("coords"))&&jQuery.ajax({url:item_admin_obj.ajax_url,type:"POST",async:!1,data:{action:"get_custom_meta",_ajax_nonce:item_admin_obj.item_admin_nonce,pid:t.get("pid")},success:function(a){5==e.currentTab&&(this_item.set("coords",a._map_coords[0]),t.set("coords",a._map_coords[0])),6==e.currentTab&&(this_item.set("key_date",a._timeline_date[0]),t.set("key_date",a._timeline_date[0]))}}),view=new p.ItemView({model:this_item}),jQuery("#local").append(view.el),6==e.currentTab&&jQuery("#local").find("li:last-of-type").append("<p>Date: <span class='key_date'>"+this_item.get("key_date")+"</span></p>"),5==e.currentTab&&jQuery("#local").find("li:last-of-type").append("<p>Map Info: <span class='coords'>"+this_item.get("coords")+"</span></p>"),null!=e.shortcode.items&&e.shortcode.items.where({pid}).length>0&&jQuery("#local").find("li:last-of-type input").prop("checked",!0)}))}},addMediaItems:function(e){"undefined"!=typeof frame&&frame.close(),1==this.currentTab?multiple=!1:multiple=!0;var t=this;frame=wp.media.frames.drstk_frame=wp.media({title:"Select Images",button:{text:"Add Selected Images"},multiple}),frame.on("select",(function(){var e=frame.state().get("selection").toJSON();jQuery.each(e,(function(e){pid=this.id.toString(),title=this.title,thumbnail=null!=this.sizes?this.sizes.thumbnail.url:this.image.src,repo="local",void 0!==t.shortcode.items&&0!=t.shortcode.items.where({pid}).length||(this_item=new p.Item,this_item.set("pid",pid).set("thumbnail",thumbnail).set("repo",repo).set("title",title),5!=t.currentTab&&6!=t.currentTab||jQuery.ajax({url:item_admin_obj.ajax_url,type:"POST",async:!1,data:{action:"get_custom_meta",_ajax_nonce:item_admin_obj.item_admin_nonce,pid:this_item.get("pid")},success:function(e){6==t.currentTab&&this_item.set("key_date",e._timeline_date[0]),5==t.currentTab&&this_item.set("coords",e._map_coords[0])}}),void 0===t.shortcode.items?t.shortcode.items=new p.Items(this_item):0==t.shortcode.items.where({pid}).length&&t.shortcode.items.add(this_item),view=new p.ItemView({model:this_item}),jQuery("#local").append(view.el),jQuery("#local").find("li:last-of-type input").prop("checked",!0),6==t.currentTab&&jQuery("#local").find("li:last-of-type").append("<p>Date: <span class='key_date'>"+this_item.get("key_date")+"</span></p>"),5==t.currentTab&&jQuery("#local").find("li:last-of-type").append("<p>Map Info: <span class='coords'>"+this_item.get("coords")+"</span></p>")),1==t.currentTab&&jQuery.ajax({url:item_admin_obj.ajax_url,type:"POST",data:{action:"get_post_meta",_ajax_nonce:item_admin_obj.item_admin_nonce,pid},success:function(e){choices={},settings=t.shortcode.get("settings"),e.post_title&&(choices.title="Title"),e.post_excerpt&&(choices.caption="Caption"),oldmeta=settings.where({name:"metadata"}),settings.remove(oldmeta),Object.keys(choices).length>0&&(settings.add({name:"metadata",label:"Metadata to Display",tag:"checkbox",value:[],choices}),t.shortcode.set("settings",settings))}})}))})).open()},dplaSort:function(e){e.preventDefault(),this.searchParams.sort=jQuery("select[name='dpla-sort']").val(),this.getDPLAitems()},dplaFacet:function(e){e.preventDefault(),link=jQuery(e.currentTarget),null==this.searchParams.facets[link.data("facet-name")]?this.searchParams.facets[link.data("facet-name")]=link.data("facet-val"):this.searchParams.facets[link.data("facet-name")].length>0&&(orig_value=this.searchParams.facets[link.data("facet-name")],"string"==typeof orig_value?this.searchParams.facets[link.data("facet-name")]=[orig_value,link.data("facet-val")]:this.searchParams.facets[link.data("facet-name")].push(link.data("facet-val"))),this.getDPLAitems()},dplaFacetToggle:function(e){e.preventDefault(),jQuery(".dpla-facets").toggleClass("hidden"),jQuery("#dpla ol").toggleClass("fullwidth"),jQuery(".dpla-facets").hasClass("hidden")?jQuery(".dpla-facets-button").removeClass("hidden"):jQuery(".dpla-facets-button").addClass("hidden")},dplaUpdateDate:function(e){e.preventDefault(),this.getDPLAitems()},dplaFacetRemove:function(e){e.preventDefault(),link=jQuery(e.currentTarget),values=this.searchParams.facets[link.data("facet-name")],"date"!=link.data("facet-name")&&(new_values=[],"string"!=typeof values&&_.each(values,(function(e){e!=link.data("facet-val")&&new_values.push(e)})),0==new_values.length?delete this.searchParams.facets[link.data("facet-name")]:this.searchParams.facets[link.data("facet-name")]=new_values,this.getDPLAitems())},dplaFacetExpand:function(e){e.preventDefault(),link=jQuery(e.currentTarget),facet_name=link.data("facet-name"),jQuery(".dpla-expanded-facet-"+facet_name).toggleClass("hidden"),jQuery(".dpla-expanded-facet-"+facet_name).hasClass("hidden")?link.text("View More"):link.text("View Less")},drsSort:function(e){e.preventDefault(),this.searchParams.sort=jQuery("select[name='drs-sort']").val(),this.getDRSitems()},drsFacet:function(e){e.preventDefault(),link=jQuery(e.currentTarget),null==this.searchParams.facets[link.data("facet-name")]?this.searchParams.facets[link.data("facet-name")]=link.data("facet-val"):this.searchParams.facets[link.data("facet-name")].length>0&&(orig_value=this.searchParams.facets[link.data("facet-name")],"string"==typeof orig_value?this.searchParams.facets[link.data("facet-name")]=[orig_value,link.data("facet-val")]:this.searchParams.facets[link.data("facet-name")].push(link.data("facet-val"))),this.getDRSitems()},drsFacetToggle:function(e){e.preventDefault(),jQuery(".drs-facets").toggleClass("hidden"),jQuery("#drs ol").toggleClass("fullwidth"),jQuery(".drs-facets").hasClass("hidden")?jQuery(".drs-facets-button").removeClass("hidden"):jQuery(".drs-facets-button").addClass("hidden")},drsFacetRemove:function(e){e.preventDefault(),link=jQuery(e.currentTarget),values=this.searchParams.facets[link.data("facet-name")],new_values=[],"string"!=typeof values&&_.each(values,(function(e){e!=link.data("facet-val")&&new_values.push(e)})),0==new_values.length?delete this.searchParams.facets[link.data("facet-name")]:this.searchParams.facets[link.data("facet-name")]=new_values,this.getDRSitems()},drsFacetExpand:function(e){e.preventDefault(),link=jQuery(e.currentTarget),facet_name=link.data("facet-name"),jQuery(".drs-expanded-facet-"+facet_name).toggleClass("hidden"),jQuery(".drs-expanded-facet-"+facet_name).hasClass("hidden")?link.text("View More"):link.text("View Less")}}),jQuery((function(e){e("body").on("click","#drs-backbone_modal",(function(e){e.preventDefault(),void 0===p.backbone_modal.__instance&&(p.backbone_modal.__instance=new p.backbone_modal.Application)}))})),window.drstk=p})();